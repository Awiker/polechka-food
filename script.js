const TELEGRAM_BOT_TOKEN = "8379872735:AAGRR2vEqYq6cluavGtNL9gGaxGyJKRKeAc";
const CHAT_ID = "8379872735";

const menu = {
  "???????? ????": [
    "????? ?????????", "????? ???????????", "???????? ? ?????",
    "????????? ???? ? ?????", "????????? ?????", "???????? ????????",
    "????? ? ????????? ????", "??? (???????, ??????, ????)", "??????? ???????"
  ],
  "???????": {
    "???????": ["????????", "?????????", "?????", "???? ? ???????", "?????????", "???"],
    "???": ["??????? ? ???????", "?????", "?????????/?????????", "??????? ???? ? ????????", "???? ? ?????", "?????", "??????"]
  },
  "????": ["?????", "?????????", "?????", "??????????", "??????", "?????????", "?????? ? ???????", "???????"],
  "?????? ???": ["??? ??? ?????? ???????? ? ????????"]
};

const cart = [];

function createMenu() {
  const menuContainer = document.getElementById("menu");

  for (const section in menu) {
    const sectionEl = document.createElement("div");
    const h2 = document.createElement("h2");
    h2.textContent = section;
    sectionEl.appendChild(h2);

    const items = menu[section];
    if (Array.isArray(items)) {
      items.forEach(item => sectionEl.appendChild(createItem(item)));
    } else {
      for (const sub in items) {
        const subH3 = document.createElement("h3");
        subH3.textContent = sub;
        sectionEl.appendChild(subH3);
        items[sub].forEach(item => sectionEl.appendChild(createItem(item)));
      }
    }

    menuContainer.appendChild(sectionEl);
  }
}

function createItem(name) {
  const btn = document.createElement("button");
  btn.textContent = `? ${name}`;
  btn.onclick = () => {
    cart.push(name);
    renderCart();
  };
  return btn;
}

function renderCart() {
  const cartEl = document.getElementById("cart");
  cartEl.innerHTML = "";
  cart.forEach((item, i) => {
    const li = document.createElement("li");
    li.textContent = item;
    const remove = document.createElement("button");
    remove.textContent = "?";
    remove.onclick = () => {
      cart.splice(i, 1);
      renderCart();
    };
    li.appendChild(remove);
    cartEl.appendChild(li);
  });
}

function placeOrder() {
  if (cart.length === 0) {
    alert("??????? ?????!");
    return;
  }

  const comment = document.getElementById("comment").value;
  const message = `?? ????? ?????:\n${cart.map(i => "• " + i).join("\n")}\n\n?? ???????????: ${comment}`;

  fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      chat_id: CHAT_ID,
      text: message
    })
  })
    .then(res => res.json())
    .then(() => {
      alert("? ????? ?????????!");
      cart.length = 0;
      renderCart();
      document.getElementById("comment").value = "";
    })
    .catch(() => alert("? ?????? ????????"));
}

// ????????
let bgIndex = 0;
const images = ["bg1.jpg", "bg2.jpg", "bg3.jpg"];
function nextBg() {
  const slideshow = document.getElementById("slideshow");
  slideshow.style.backgroundImage = `url(${images[bgIndex]})`;
  bgIndex = (bgIndex + 1) % images.length;
}
setInterval(nextBg, 5000);

createMenu();
nextBg();
